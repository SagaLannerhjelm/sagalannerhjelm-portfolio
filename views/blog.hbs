

{{#if blogposts}}

<div class="blog-page padding-on-bottom">

{{#if session.isLoggedIn}}
  <a class="add-button new-blog-button" href="/new-blog">+</a>
{{/if}}

{{! Display server error messages }}
  {{#if serverErrorMessages.length}}
    <div class="error-message-container bg-error">
      <ul class="error-message text-light">
        {{#each serverErrorMessages}}
          <li class="error-message-list">{{this}}</li>
        {{/each}}
      </ul>
    </div>
  {{/if}}

  {{#if blogposts.length}}
    {{#each blogposts as | blogpost |}}
      <div class="blog-container" id="blog/{{blogId}}">
        <h2 class="title text-primary float-left">{{blogTitle}}
          {{#if ../session.isLoggedIn}}
            {{!-- Edit button --}}
            <a href="/edit-blog/{{blogId}}?page={{../pageNumber}}"><img class="icons margin-left" src="/images/edit_icon_dark.png"  alt="Edit icon"/></a>

            {{!-- Delete button --}}
            <form
              action="/delete-blog/{{blogId}}"
              method="post"
              class="delete-button">
              <button type="submit" class="icon-button white-button">
                <img class="icons" src="/images/delete_icon_dark.png" alt="Delete icon" />
              </button>
            </form>
          {{/if}}
        </h2>
        <p class="blog-date">{{blogPublishedDate}}</p>
        <p class="blog-descr">{{blogDescription}}</p>
        <img class="blog-pic" src="/uploads/{{blogPictureName}}" alt="Blog picture">

      
        {{!-- {{#if ../errorAtBlogId.length}} --}}
          {{#ifEquals ../errorAtBlogId blogpost.blogId}}
          
            {{! Display error messages }}
              {{#if ../errorMessages.length}}
                <div class="error-message-container-extended bg-error">
                  <ul class="error-message text-light">
                    {{#each ../errorMessages}}
                      <li class="error-message-list">{{this}}</li>
                    {{/each}}
                  </ul>
                </div>
              {{/if}}
            
          {{/ifEquals}}
        {{!-- {{/if}} --}}
         

        {{!-- Form for creating comments --}}
        {{#unless ../session.isLoggedIn}}
          <div class="card-title h4 form-title" id="new-comment-section/{{blogId}}">Write a comment</div>
          <form action="/blog?page={{../pageNumber}}" method="post">
          <input type="hidden" name="id" value="{{blogId}}">
            <div class="form-group">
              {{!-- <input type="text" name="id" value="{{blogId}}"> --}}
              <label class="form-label">Name</label>
              <input class="form-input" type="text" name="name" placeholder="Write your name here...">
            </div>
            <div class="form-group">
              <label class="form-label">Comment</label>
              <input class="form-input" type="text" name="comment" placeholder="Write a comment...">
            </div>
            <input class="btn btn-primary send-comment-button" type="submit" value="Send">
          </form>
        {{/unless}}
      </div>
      {{!-- Show comments --}}
      {{#if comments}}
        <h5 class="comments-title" id="comment-section/{{blogId}}">Comments</h5>
        {{#each comments}}
          {{!-- Show the right comments on the right blogpost --}}
          {{!-- {{#ifEquals cmnt.blogId blogpost.blogId}} --}}
            <div class="comment-container" id="comment/{{cmntId}}">
              <div class="comment-grid">
                <p class="name">{{cmntName}}</p>
                <p class="comment-date">{{cmntPublishedDate}}</p>
              </div>
              <div class="comment-grid ">
                <p class="comment">{{cmntContent}}</p>
                {{!-- Buttons for editing and deleting comment --}}
                <div class="float-right comment-icons">
                  {{#if ../../session.isLoggedIn}}
                    {{!-- edit button --}}
                    <a href="/edit-comment/{{cmntId}}/page={{../../pageNumber}}" class="icon-button blue-button"><img class="icons" src="/images/edit_icon_light.png" alt="Edit icon"/></a>
                    {{!-- delete button --}}
                    <form action="/delete-comment/{{cmntId}}" method="post">
                     <input type="hidden" name="blogId" value="{{blogId}}">
                      <button type="submit" class="icon-button blue-button"><img class="icons" src="/images/delete_icon_light.png" alt="Delete icon"/></button>
                    </form>
                  {{/if}}
                </div>
              </div>
            </div>
          {{!-- {{/ifEquals}} --}}
        {{/each}}
      {{/if}}

    {{/each}}
    {{else}}
        <p>No blogposts exists yet...</p>
  {{/if}}
</div>


 {{!-- Pagination --}}
<div class="blog-pagination">
  {{#if pageNumbers.length}}
    <ul class="pagination">
      <li class="page-item 
      {{#if previousPageDisabled}}disabled{{/if}}
      ">
        <a href="{{previousPageUrl}}" tabindex="-1">Previous</a>
      </li>
      {{#each pageNumbers}}
      <li class="page-item {{#if this.active}} active {{/if}}
      ">
        <a href="/blog?page={{this.page}}" class="{{#unless this.active}}text-primary{{/unless}}">{{this.page}}</a>
      </li>
      {{/each}}
      <li class="page-item {{#if nextPageDisabled}}disabled{{/if}}">
        <a href="{{nextPageUrl}}">Next</a>
      </li>
    </ul>
  {{/if}}
</div> 

{{else}}
  <img
      src="/images/low_opacity_clouds.png"
      alt="Illustration of clouds"
      class="cloud clouds-picture"
    />
    <div class="locked-page">
      <div class="">
        <h4 class="position-relative">This page cannot be found</h4>
      </div>
    </div>

{{/if}}